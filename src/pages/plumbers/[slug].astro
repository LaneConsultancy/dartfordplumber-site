---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import HeroV2 from '../../components/HeroV2.astro';
import Reviews from '../../components/Reviews.astro';
import Footer from '../../components/Footer.astro';
import plumbersData from '../../data/top-plumbers.json';

export async function getStaticPaths() {
  const plumbers = plumbersData.map((plumber, idx) => ({
    ...plumber,
    idx,
    slug: plumber.name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '')
  }));

  return plumbers.map((plumber) => ({
    params: { slug: plumber.slug },
    props: { plumber },
  }));
}

const { plumber } = Astro.props;

// Hero image rotation logic
const heroImages = [
  '/images/plumber-hero-van.jpg',
  '/images/plumber-hero-hands-tap.jpg',
  '/images/plumber-hero-boiler.jpg',
  '/images/plumber-hero-tools-overhead.jpg',
  '/images/plumber-hero-sink-install.jpg',
  '/images/plumber-hero-radiator.jpg'
];
const heroImage = heroImages[plumber.idx % 6];

// Generate schema.org LocalBusiness structured data
const schema = {
  "@context": "https://schema.org",
  "@type": "Plumber",
  "name": plumber.name,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": plumber.address,
    "addressLocality": "Dartford",
    "addressRegion": "Kent",
    "addressCountry": "GB"
  },
  "telephone": plumber.phone,
  "url": plumber.website,
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": plumber.rating,
    "bestRating": "5"
  },
  "priceRange": "££"
};
---

<BaseLayout
  title={`${plumber.name} - Dartford Plumber | ${plumber.rating}★ Rated`}
  description={`${plumber.name} is a trusted plumber in Dartford with a ${plumber.rating}-star rating. Specialising in ${plumber.categories.slice(0, 3).join(', ')}. Call ${plumber.phone} today.`}
  canonical={`/plumbers/${plumber.slug}`}
>
  <script type="application/ld+json" set:html={JSON.stringify(schema)} />

  <!-- Breadcrumbs -->
  <Breadcrumbs
    items={[
      { label: 'Home', href: '/' },
      { label: plumber.name }
    ]}
  />

  <!-- Hero Section with HeroV2 -->
  <HeroV2
    headline={plumber.name}
    subheadline={`${plumber.rating}★ Rated Plumber in Dartford`}
    backgroundImage={heroImage}
    primaryCTA={`Call ${plumber.phone}`}
    primaryCTAHref={`tel:${plumber.phone.replace(/\s/g, '')}`}
    secondaryCTA="01322 936116"
    secondaryCTAHref="tel:01322936116"
  />

  <!-- Contact & Services Section -->
  <section class="plumber-details">
    <div class="plumber-details__container section-container">
      <div class="plumber-details__grid">
        <!-- Contact Card -->
        <div class="contact-card">
          <h2 class="contact-card__heading">Contact Information</h2>
          <div class="contact-card__items">
            <div class="contact-card__item">
              <svg class="contact-card__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <div>
                <p class="contact-card__label">Address</p>
                <p class="contact-card__value">{plumber.address}</p>
              </div>
            </div>

            <div class="contact-card__item">
              <svg class="contact-card__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
              </svg>
              <div>
                <p class="contact-card__label">Phone</p>
                <a href={`tel:${plumber.phone.replace(/\s/g, '')}`} class="contact-card__link">
                  {plumber.phone}
                </a>
              </div>
            </div>

            {plumber.website && (
              <div class="contact-card__item">
                <svg class="contact-card__icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                </svg>
                <div>
                  <p class="contact-card__label">Website</p>
                  <a href={plumber.website} target="_blank" rel="noopener noreferrer" class="contact-card__link">
                    {plumber.website.replace(/^https?:\/\//, '')}
                  </a>
                </div>
              </div>
            )}
          </div>
        </div>

        <!-- Services Card -->
        <div class="services-card">
          <h2 class="services-card__heading">Services</h2>
          <div class="services-card__badges">
            {plumber.categories.map((category) => (
                <span class="services-card__badge">
                  {category}
                </span>
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section class="about-section">
    <div class="about-section__container section-container">
      <h2 class="about-section__heading">About {plumber.name}</h2>
      <div class="about-section__content">
        <p>
          {plumber.name} is a trusted plumbing service based in Dartford, Kent. With a {plumber.rating}-star rating from verified customer reviews, they've built a reputation for reliable, professional service across the local area.
        </p>
        <p>
          Specialising in {plumber.categories.slice(0, 3).join(', ')}, {plumber.name} serves customers throughout Dartford and surrounding areas including Stone, Swanscombe, Greenhithe, and Crayford.
        </p>
        <p>
          For emergency call-outs, planned installations, or general plumbing advice, contact {plumber.name} directly on {plumber.phone}.
        </p>
      </div>
    </div>
  </section>

  <!-- Reviews Section -->
  <Reviews companyName={plumber.name} />

  <!-- CTA Section -->
  <section class="final-cta">
    <div class="final-cta__container section-container">
      <h2 class="final-cta__heading section-heading">Need a Plumber in Dartford?</h2>
      <p class="final-cta__text">
        Contact {plumber.name} today for professional plumbing services.
      </p>
      <div class="final-cta__actions">
        <a
          href={`tel:${plumber.phone.replace(/\s/g, '')}`}
          class="final-cta__button final-cta__button--primary"
        >
          <svg class="final-cta__button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
          </svg>
          <span>Call {plumber.phone}</span>
        </a>
        <a href="/#plumbers" class="final-cta__button final-cta__button--secondary">
          <svg class="final-cta__button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          <span>Back to Directory</span>
        </a>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>

<style>
  /* Base Section Styles */
  section {
    padding: var(--space-16) var(--space-6);
  }

  @media (min-width: 768px) {
    section {
      padding: var(--space-20) var(--space-8);
    }
  }

  .section-container {
    max-width: 1280px;
    margin: 0 auto;
  }

  /* Plumber Details Section */
  .plumber-details {
    background: var(--color-bg-alt);
  }

  .plumber-details__grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--space-8);
  }

  /* Contact Card */
  .contact-card {
    background: var(--color-bg);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--border-radius-xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-md);
    transition: all var(--transition-base);
  }

  .contact-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .contact-card__heading {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--color-gray-950);
    margin-bottom: var(--space-6);
  }

  .contact-card__items {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  .contact-card__item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-4);
  }

  .contact-card__icon {
    width: 1.5rem;
    height: 1.5rem;
    color: var(--color-primary);
    flex-shrink: 0;
    margin-top: 2px;
  }

  .contact-card__label {
    font-family: var(--font-body);
    font-size: var(--text-xs);
    font-weight: var(--font-bold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
    margin-bottom: 2px;
  }

  .contact-card__value,
  .contact-card__link {
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: var(--font-medium);
    color: var(--color-text);
    text-decoration: none;
  }

  .contact-card__link {
    color: var(--color-primary);
    transition: color var(--transition-fast);
  }

  .contact-card__link:hover {
    color: var(--color-primary-dark);
    text-decoration: underline;
  }

  /* Services Card */
  .services-card {
    background: var(--color-bg);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--border-radius-xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-md);
    transition: all var(--transition-base);
  }

  .services-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .services-card__heading {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--color-gray-950);
    margin-bottom: var(--space-6);
  }

  .services-card__badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .services-card__badge {
    display: inline-flex;
    padding: var(--space-2) var(--space-4);
    font-family: var(--font-body);
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--color-primary);
    background: var(--color-gray-100);
    border-radius: var(--border-radius-full);
    transition: all var(--transition-base);
  }

  .services-card__badge:hover {
    background-color: var(--color-gray-200);
    transform: translateY(-2px);
  }

  /* About Section */
  .about-section {
    background: var(--color-bg);
  }

  .about-section__container {
    max-width: 800px;
    margin: 0 auto;
  }

  .about-section__heading {
    font-family: var(--font-display);
    font-size: var(--text-3xl);
    font-weight: var(--font-bold);
    color: var(--color-gray-950);
    margin-bottom: var(--space-6);
  }

  .about-section__content {
    font-family: var(--font-body);
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    color: var(--color-text-muted);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  /* Final CTA Section */
  .final-cta {
    background: var(--color-primary);
    color: white;
    text-align: center;
  }

  .final-cta__container {
    max-width: 800px;
    margin: 0 auto;
  }

  .final-cta__heading {
    color: white;
    margin-bottom: var(--space-4);
  }

  .final-cta__text {
    font-family: var(--font-body);
    font-size: var(--text-lg);
    color: var(--color-gray-200);
    margin-bottom: var(--space-8);
  }

  .final-cta__actions {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-4);
  }

  .final-cta__button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-8);
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: var(--font-bold);
    text-decoration: none;
    border-radius: var(--border-radius-lg);
    transition: all var(--transition-base);
    min-height: 44px;
  }

  .final-cta__button--primary {
    background-color: var(--color-accent);
    color: white;
    box-shadow: var(--shadow-lg);
  }

  .final-cta__button--primary:hover {
    background-color: var(--color-accent-dark);
    transform: translateY(-3px);
    box-shadow: var(--shadow-xl);
  }

  .final-cta__button--secondary {
    background-color: white;
    color: var(--color-primary);
    box-shadow: var(--shadow-md);
  }

  .final-cta__button--secondary:hover {
    background-color: var(--color-gray-50);
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
  }

  .final-cta__button-icon {
    width: 1.25rem;
    height: 1.25rem;
  }
</style>
